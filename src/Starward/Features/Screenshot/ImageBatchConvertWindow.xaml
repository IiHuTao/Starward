<?xml version="1.0" encoding="utf-8" ?>
<sf:WindowEx x:Class="Starward.Features.Screenshot.ImageBatchConvertWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:lang="using:Starward.Language"
             xmlns:local="using:Starward.Features.Screenshot"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sf="using:Starward.Frameworks"
             Title="{x:Bind lang:Lang.ImageBatchConvertWindow_ImageBatchConvert}"
             x:DefaultBindMode="OneWay"
             mc:Ignorable="d">


    <Grid x:Name="RootGrid"
          Loaded="RootGrid_Loaded"
          Unloaded="RootGrid_Unloaded">
        <Grid.RowDefinitions>
            <RowDefinition Height="32" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <TextBlock Margin="12,0,0,0"
                   VerticalAlignment="Center"
                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                   Text="{x:Bind lang:Lang.ImageBatchConvertWindow_ImageBatchConvert}" />

        <Grid Grid.Row="1" Margin="12,4,12,0">
            <StackPanel VerticalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="12">
                <!--  导入  -->
                <Button x:Name="Button_Import"
                        VerticalAlignment="Center"
                        Click="Button_Import_Click"
                        Content="{x:Bind lang:Lang.GachaImportAndExportWindow_Import}" />
                <!--  输出格式  -->
                <ComboBox x:Name="ComboBox_OutputFormat"
                          MinWidth="100"
                          Padding="18.5,0,0,0"
                          VerticalAlignment="Center"
                          PlaceholderText="{x:Bind lang:Lang.ImageBatchConvertWindow_SelectOutputFormat}">
                    <ComboBoxItem Content="JPEG" />
                    <ComboBoxItem Content="PNG" />
                    <ComboBoxItem Content="AVIF" />
                    <ComboBoxItem Content="JPEG XL" />
                </ComboBox>
                <!--  文件已存在  -->
                <ComboBox x:Name="ComboBox_OutputFileExists"
                          MinWidth="120"
                          Padding="18.5,0,0,0"
                          VerticalAlignment="Center"
                          PlaceholderText="{x:Bind lang:Lang.ImageBatchConvertWindow_IfOutputFileExists}">
                    <ComboBoxItem Content="{x:Bind lang:Lang.ImageBatchConvertWindow_SkipDefault}" />
                    <ComboBoxItem Content="{x:Bind lang:Lang.ImageBatchConvertWindow_Overwrite}" />
                    <ComboBoxItem Content="{x:Bind lang:Lang.ImageBatchConvertWindow_Rename}" />
                </ComboBox>
                <!--  质量  -->
                <TextBlock VerticalAlignment="Center" Text="{x:Bind lang:Lang.ImageBatchConvertWindow_Quality}" />
                <Slider x:Name="Slider_Quality"
                        Width="120"
                        VerticalAlignment="Center"
                        Maximum="100"
                        Minimum="0"
                        Value="90" />
                <TextBlock MinWidth="32"
                           VerticalAlignment="Center"
                           Text="{x:Bind Slider_Quality.Value}" />
                <AppBarSeparator />
                <!--  开始转换  -->
                <Button x:Name="Button_StartConvert"
                        VerticalAlignment="Center"
                        Click="Button_StartConvert_Click"
                        Content="{x:Bind lang:Lang.ImageBatchConvertWindow_StartConvert}" />
                <ProgressRing Width="24"
                              Height="24"
                              IsIndeterminate="True"
                              Visibility="{x:Bind IsConverting}" />
                <!--  转换信息  -->
                <TextBlock VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           Visibility="{x:Bind DisplayInfo}">
                    <Run Text="{x:Bind lang:Lang.Common_Success}" />
                    <Run Text="{x:Bind SuccessCount}" /><Run Text="/" /><Run Text="{x:Bind TotalCount}" />
                    <Run Text="" />
                    <Run Text="" />
                    <Run Text="{x:Bind lang:Lang.Common_Failed}" />
                    <Run Text="{x:Bind ErrorCount}" />
                    <Run Text="" />
                    <Run Text="" />
                    <Run Text="{x:Bind local:ImageBatchConvertWindow.SizeToString(TotalSourceFileSize)}" />
                    <Run Text="→" />
                    <Run Text="{x:Bind local:ImageBatchConvertWindow.SizeToString(TotalOutputFileSize)}" />
                </TextBlock>
            </StackPanel>

            <StackPanel HorizontalAlignment="Right"
                        Orientation="Horizontal"
                        Spacing="12">

                <!--  停止  -->
                <Button x:Name="Button_Stop"
                        Click="Button_Stop_Click"
                        Content="{x:Bind lang:Lang.DownloadGamePage_Stop}" />

                <!--  清除  -->
                <Button x:Name="Button_Clear"
                        Click="Button_Clear_Click"
                        Content="{x:Bind lang:Lang.Common_Clear}" />
            </StackPanel>
        </Grid>


        <Grid Grid.Row="2"
              Margin="12,4,12,0"
              ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Button x:Name="Button_OutputFolder"
                    Click="Button_OutputFolder_Click"
                    Content="{x:Bind lang:Lang.ImageBatchConvertWindow_OutputFolder}" />
            <TextBlock Grid.Column="1"
                       VerticalAlignment="Center"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Text="{x:Bind OutputFolder}"
                       TextTrimming="CharacterEllipsis" />
        </Grid>



        <ListView x:Name="ListView_ImageConvertItems"
                  Grid.Row="3"
                  Margin="0,8,0,0"
                  AllowDrop="True"
                  DragOver="ListView_ImageConvertItems_DragOver"
                  Drop="ListView_ImageConvertItems_Drop"
                  ItemsSource="{x:Bind ImageConvertItems}"
                  SelectionMode="None">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="local:ImageConvertItem">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <!--  原文件  -->
                        <Border Width="300">
                            <HyperlinkButton x:Name="HyperlinkButton_SourceFileName"
                                             HorizontalAlignment="Left"
                                             Click="HyperlinkButton_SourceFileName_Click">
                                <TextBlock Text="{x:Bind SourceFileName}" TextTrimming="CharacterEllipsis" />
                            </HyperlinkButton>
                        </Border>
                        <Border Width="80">
                            <TextBlock HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       Text="{x:Bind SourceFileSizeText}" />
                        </Border>

                        <!--  进度提醒  -->
                        <ProgressRing Width="16"
                                      Height="16"
                                      Margin="12,0,0,0"
                                      VerticalAlignment="Center"
                                      IsIndeterminate="True"
                                      Visibility="{x:Bind Converting}" />

                        <TextBlock Margin="12,0,0,0"
                                   VerticalAlignment="Center"
                                   FontFamily="{ThemeResource SymbolThemeFontFamily}"
                                   FontSize="16"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   Text="&#xEBE7;"
                                   Visibility="{x:Bind ConvertSuccess}" />

                        <!--  输出文件  -->
                        <Border Width="300"
                                Margin="12,0,0,0"
                                Visibility="{x:Bind ConvertSuccess}">
                            <HyperlinkButton x:Name="HyperlinkButton_OutputFileName"
                                             HorizontalAlignment="Left"
                                             Click="HyperlinkButton_OutputFileName_Click">
                                <TextBlock Text="{x:Bind OutputFileName}" TextTrimming="CharacterEllipsis" />
                            </HyperlinkButton>
                        </Border>
                        <Border Width="80" Visibility="{x:Bind ConvertSuccess}">
                            <TextBlock HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       Text="{x:Bind OutputFileSizeText}" />
                        </Border>
                        <Border Width="60" Visibility="{x:Bind ConvertSuccess}">
                            <TextBlock HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       Foreground="{x:Bind FileDeltaTextBrush}"
                                       Text="{x:Bind FileDeltaPercent}" />
                        </Border>

                        <!--  错误  -->
                        <TextBlock Margin="64,0,0,0"
                                   VerticalAlignment="Center"
                                   Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                   Text="{x:Bind ErrorMessage}"
                                   Visibility="{x:Bind ConvertError}" />

                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>



    </Grid>

</sf:WindowEx>
